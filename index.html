<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8" />
  <!-- Website Icon (Favicon) -->
<link rel="icon" href="icon.png" type="image/png">

<!-- Open Graph (Facebook, WhatsApp, LinkedIn preview) -->
<meta property="og:image" content="https://samer7667.github.io/reading-translator/icon.png">
<meta property="og:title" content="Reading Translator">
<meta property="og:description" content="ØªØ±Ø¬Ù… Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© ÙˆØ§Ø­ÙØ¸Ù‡Ø§ Ù„Ù…Ø±Ø§Ø¬Ø¹ØªÙ‡Ø§ Ù„Ø§Ø­Ù‚Ù‹Ø§">
<meta property="og:type" content="website">
<meta property="og:url" content="https://samer7667.github.io/reading-translator/">

<!-- Twitter Card preview -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Reading Translator">
<meta name="twitter:description" content="ØªØ±Ø¬Ù… Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© ÙˆØ§Ø­ÙØ¸Ù‡Ø§ Ù„Ù…Ø±Ø§Ø¬Ø¹ØªÙ‡Ø§ Ù„Ø§Ø­Ù‚Ù‹Ø§">
<meta name="twitter:image" content="https://samer7667.github.io/reading-translator/icon.png">

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Reading Word Translator â€” EN â‡¢ AR</title>
  <style>
    :root{
      --bg:#0b1220; --panel:#121a2b; --muted:#8aa0bf; --text:#e9f0ff; --acc:#5ea0ff; --acc2:#7ef0d6; --warn:#ff9f43; --danger:#ff5d5d;
      --ring: 0 0 0 3px rgba(94,160,255,.3);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,"Noto Sans",sans-serif;background:linear-gradient(180deg,#0b1220,#0e1626 60%);color:var(--text)}
    a{color:var(--acc)}
    .container{max-width:1100px;margin:0 auto;padding:16px}
    .app{display:grid;grid-template-columns:1fr;gap:16px}
    @media(min-width:900px){.app{grid-template-columns:340px 1fr}}
    .card{background:var(--panel);border:1px solid rgba(255,255,255,.07);border-radius:18px;box-shadow:0 10px 30px rgba(0,0,0,.3)}
    .card h2{margin:0 0 8px 0;font-size:20px}
    .card .body{padding:16px}
    .muted{color:var(--muted)}
    .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .btn{appearance:none;border:none;border-radius:14px;padding:10px 14px;font-weight:600;color:#071225;background:var(--acc);cursor:pointer;transition:.2s;box-shadow:0 6px 20px rgba(94,160,255,.25)}
    .btn:hover{transform:translateY(-1px)}
    .btn.secondary{background:#1f2b44;color:var(--text);box-shadow:none;border:1px solid rgba(255,255,255,.08)}
    .btn.ghost{background:transparent;color:var(--text);border:1px dashed rgba(255,255,255,.2)}
    .btn.warn{background:var(--warn)}
    .btn.danger{background:var(--danger)}
    .field{display:flex;flex-direction:column;gap:6px}
    .input, textarea{width:100%;background:#0a1221;border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:10px 12px;color:var(--text);outline:none}
    .input:focus, textarea:focus{box-shadow:var(--ring);border-color:rgba(94,160,255,.5)}
    textarea{min-height:120px;resize:vertical}
    .reading{line-height:1.9;background:#0a1221;border:1px solid rgba(255,255,255,.08);border-radius:16px;padding:16px;min-height:220px}
    .reading span.word{padding:2px 0;border-radius:6px;cursor:pointer}
    .reading span.word.known{background:rgba(126,240,214,.12);box-shadow:inset 0 0 0 1px rgba(126,240,214,.35)}
    .reading span.word:hover{background:rgba(94,160,255,.12)}

    .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:24px;background:#0a1221;border:1px solid rgba(255,255,255,.1);padding:10px 12px;border-radius:12px;display:none;z-index:50}

    .floating{position:absolute;z-index:40;min-width:260px;background:#0a1221;border:1px solid rgba(255,255,255,.12);border-radius:14px;box-shadow:0 10px 40px rgba(0,0,0,.5);padding:12px;display:none;cursor:move;}
    .floating h4{margin:0 0 8px 0;font-size:14px;color:var(--muted)}

    /* Drawer */
    .drawer{position:fixed;inset:0;pointer-events:none}
    .drawer.open{pointer-events:auto}
    .drawer .backdrop{position:absolute;inset:0;background:rgba(0,0,0,.55);opacity:0;transition:.2s}
    .drawer.open .backdrop{opacity:1}
    .drawer .panel{position:absolute;top:0;right:-420px;width:420px;max-width:100%;height:100%;background:var(--panel);border-left:1px solid rgba(255,255,255,.08);transition:.25s;padding:16px;overflow:auto}
    .drawer.open .panel{right:0}
    table{width:100%;border-collapse:collapse}
    th,td{border-bottom:1px solid rgba(255,255,255,.08);padding:8px 6px;text-align:left}
    td.actions{white-space:nowrap}
    .tag{display:inline-block;padding:2px 8px;border-radius:999px;background:#11203a;color:var(--muted);font-size:12px}
    
    /* Quiz styles */
    .quiz-option.correct {
      background: var(--acc2) !important;
      color: #071225 !important;
    }
    .quiz-option.wrong {
      background: var(--danger) !important;
      color: white !important;
    }
  </style>
</head>
<body>
  <div class="container">
    <header style="display:flex;align-items:center;justify-content:space-between;gap:12px;margin:10px 0 16px 0">
      <div>
        <h1 style="margin:0;font-size:26px">ğŸ“– Reading Word Translator <span class="tag">EN â‡¢ AR</span></h1>
        <div class="muted" style="font-size:14px">Ø§Ù†Ù‚Ø±/Ø­Ø¯Ù‘Ø¯ ÙƒÙ„Ù…Ø© Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© Ø¯Ø§Ø®Ù„ Ø§Ù„Ù†ØµØŒ Ø«Ù… Ø§ÙƒØªØ¨ ØªØ±Ø¬Ù…ØªÙ‡Ø§ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ÙˆØ³ÙŠØªÙ… Ø­ÙØ¸Ù‡Ø§ Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© (Ù…Ø­Ù„ÙŠÙ‹Ø§ ÙÙŠ Ø¬Ù‡Ø§Ø²Ùƒ).</div>
      </div>
      <div class="row">
        <button id="btnReview" class="btn">Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„ÙƒÙ„Ù…Ø§Øª</button>
        <button id="btnExport" class="btn secondary" title="ØªØµØ¯ÙŠØ± Ø§Ù„ÙƒÙ„Ù…Ø§Øª ÙƒÙ€ JSON">ØªØµØ¯ÙŠØ±</button>
        <label class="btn ghost" title="Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ù„Ù JSON Ù„Ù„ÙƒÙ„Ù…Ø§Øª" for="fileImport">Ø§Ø³ØªÙŠØ±Ø§Ø¯</label>
        <input id="fileImport" type="file" accept="application/json" style="display:none" />
      </div>
    </header>

    <div class="app">
      <section class="card">
        <div class="body">
          <h2>1) Ø¶Ø¹ Ø§Ù„Ù†Øµ Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ</h2>
          <div class="field" style="margin-bottom:10px">
            <label class="muted">Ù„ØµÙ‚/ÙƒØªØ§Ø¨Ø© Ø§Ù„Ù†Øµ Ù‡Ù†Ø§ Ø«Ù… Ø§Ø¶ØºØ· Â«ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ù†ØµÂ»</label>
            <textarea id="rawText" placeholder="Paste your English text hereâ€¦"></textarea>
          </div>
          <div class="row" style="justify-content:space-between">
            <div class="row">
              <button id="btnBuild" class="btn">ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ù†Øµ</button>
              <button id="btnClearText" class="btn secondary">Ù…Ø³Ø­ Ø§Ù„Ù†Øµ</button>
            </div>
            <button id="btnResetAll" class="btn danger" title="Ø­Ø°Ù ÙƒÙ„ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©">Ø­Ø°Ù Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©</button>
          </div>
        </div>
      </section>

      <section class="card" style="position:relative">
        <div class="body">
          <h2>2) Ø§Ù‚Ø±Ø£ Ø§Ù„Ù†Øµ ÙˆØ§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„ÙƒÙ„Ù…Ø§Øª</h2>
          <div id="reading" class="reading" tabindex="0" aria-label="Reading Area"></div>
          <div class="muted" style="margin-top:8px;font-size:13px">Ù†ØµÙŠØ­Ø©: Ø§Ù†Ù‚Ø± Ù†Ù‚Ø±Ù‹Ø§ Ù…Ø²Ø¯ÙˆØ¬Ù‹Ø§ Ø¹Ù„Ù‰ ÙƒÙ„Ù…Ø© Ù„Ø§Ø®ØªÙŠØ§Ø±Ù‡Ø§ Ø³Ø±ÙŠØ¹Ù‹Ø§. Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø¹Ø±ÙˆÙØ© ØªÙØ¸Ù„Ù„ Ø¨Ø®Ø¶Ø±Ø© Ø®ÙÙŠÙØ©.</div>
        </div>

        <!-- Floating translator -->
        <div id="float" class="floating" role="dialog" aria-modal="true">
          <h4>ØªØ±Ø¬Ù…Ø© Ø§Ù„ÙƒÙ„Ù…Ø©</h4>
          <div class="field"><input id="wordInput" class="input" placeholder="English word" /></div>
          <div class="field" style="direction:rtl"><input id="arabicInput" class="input" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„ØªØ±Ø¬Ù…Ø© Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©" /></div>
          <div class="row" style="justify-content:flex-end;margin-top:8px">
            <button id="saveWord" class="btn">Ø­ÙØ¸</button>
            <button id="deleteWord" class="btn secondary">Ø­Ø°Ù</button>
            <button id="closeFloat" class="btn ghost">Ø¥ØºÙ„Ø§Ù‚</button>
          </div>
        </div>
      </section>
    </div>
  </div>

  <!-- Drawer for Review -->
  <div id="drawer" class="drawer" aria-hidden="true">
    <div class="backdrop" data-close></div>
    <aside class="panel">
      <div style="display:flex;justify-content:space-between;align-items:center;gap:8px;position:sticky;top:0;background:var(--panel);padding-bottom:8px;z-index:1">
        <h2 style="margin:8px 0">ğŸ“š Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„ÙƒÙ„Ù…Ø§Øª</h2>
        <button class="btn ghost" data-close>Ø¥ØºÙ„Ø§Ù‚</button>
      </div>
      <div class="row" style="margin:6px 0 10px 0">
        <input id="search" class="input" placeholder="Ø¨Ø­Ø«â€¦ (English Ø£Ùˆ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©)" />
      </div>
      <table id="table">
        <thead><tr><th>English</th><th style="direction:rtl">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</th><th>Actions</th></tr></thead>
        <tbody></tbody>
      </table>
      
      <!-- Quiz Section -->
      <div id="quizSection" style="margin-top: 30px; display: none;">
        <h3>ğŸ§  Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ÙƒÙ„Ù…Ø§Øª</h3>
        <div id="quizContainer" style="background: var(--panel); border-radius: 12px; padding: 16px; margin: 12px 0;">
          <div id="quizQuestion" style="font-size: 18px; margin-bottom: 16px;"></div>
          <div id="quizOptions" style="display: grid; gap: 8px;"></div>
        </div>
        <div id="quizFeedback" style="margin: 12px 0; font-weight: bold;"></div>
        <div class="row">
          <button id="startQuiz" class="btn">Ø¨Ø¯Ø¡ Ø§Ø®ØªØ¨Ø§Ø± Ø¬Ø¯ÙŠØ¯</button>
          <button id="nextQuestion" class="btn secondary" style="display: none;">Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ</button>
        </div>
        <div id="quizStats" style="margin-top: 12px; font-size: 14px;"></div>
      </div>
      
      <div class="row" style="margin-top: 16px;">
        <button id="toggleQuiz" class="btn">Ø¹Ø±Ø¶ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ÙƒÙ„Ù…Ø§Øª</button>
      </div>
      
      <div class="muted" style="font-size:12px;margin-top:10px">ÙŠØªÙ… Ø§Ù„Ø­ÙØ¸ Ù…Ø­Ù„ÙŠÙ‹Ø§ ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­ (localStorage). ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„ØªØµØ¯ÙŠØ±/Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ ÙƒÙ…Ù„Ù JSON.</div>
    </aside>
  </div>

  <div id="toast" class="toast"></div>

  <script>
    // ================= Core State =================
    const LS_KEY = 'readingTranslator.words.v1';
    const state = {
      words: loadWords(),
      currentWord: '',
    };

    function normalizeWord(w){
      if(!w) return '';
      return w
        .toLowerCase()
        .replace(/[\u2018\u2019]/g,"'")
        .replace(/^[^a-zA-Z']+|[^a-zA-Z']+$/g,'');
    }

    function loadWords(){
      try{ return JSON.parse(localStorage.getItem(LS_KEY) || '{}'); }
      catch{ return {}; }
    }
    function saveWords(){ localStorage.setItem(LS_KEY, JSON.stringify(state.words)); }

    // ================= Building Reading =================
    const readingEl = document.getElementById('reading');
    const rawTextEl = document.getElementById('rawText');
    const btnBuild = document.getElementById('btnBuild');
    const btnClearText = document.getElementById('btnClearText');

    btnBuild.addEventListener('click', () => buildReading(rawTextEl.value));
    btnClearText.addEventListener('click', () => { rawTextEl.value=''; readingEl.innerHTML=''; });

    function buildReading(text){
      const tokens = text.split(/(\s+)/); // keep spaces
      readingEl.innerHTML = '';
      tokens.forEach(tok => {
        if(/\s+/.test(tok)){ readingEl.appendChild(document.createTextNode(tok)); return; }
        const clean = normalizeWord(tok);
        if(!clean){ readingEl.appendChild(document.createTextNode(tok)); return; }
        const span = document.createElement('span');
        span.className = 'word' + (state.words[clean] ? ' known':'' );
        span.textContent = tok; // keep original casing/punct
        span.dataset.key = clean;
        span.title = state.words[clean] ? `â†’ ${state.words[clean]}` : 'Click to translate';
        span.addEventListener('click', (e)=> onWordClick(e.currentTarget));
        readingEl.appendChild(span);
      });
    }

    function refreshKnownClasses(){
      readingEl.querySelectorAll('span.word').forEach(el => {
        const key = el.dataset.key;
        el.classList.toggle('known', !!state.words[key]);
        if(state.words[key]) el.title = `â†’ ${state.words[key]}`; else el.removeAttribute('title');
      });
    }

    // ================= Floating Panel =================
    const float = document.getElementById('float');
    const wordInput = document.getElementById('wordInput');
    const arabicInput = document.getElementById('arabicInput');
    const saveBtn = document.getElementById('saveWord');
    const delBtn = document.getElementById('deleteWord');
    const closeFloat = document.getElementById('closeFloat');

    // Floating panel dragging functionality
    let isDragging = false;
    let offsetX, offsetY;

    float.addEventListener('mousedown', (e) => {
      if (e.target.tagName === 'INPUT' || e.target.tagName === 'BUTTON') return;
      isDragging = true;
      offsetX = e.clientX - float.getBoundingClientRect().left;
      offsetY = e.clientY - float.getBoundingClientRect().top;
      float.style.cursor = 'grabbing';
      e.preventDefault();
    });

    document.addEventListener('mousemove', (e) => {
      if (!isDragging) return;
      float.style.left = (e.clientX - offsetX) + 'px';
      float.style.top = (e.clientY - offsetY) + 'px';
    });

    document.addEventListener('mouseup', () => {
      isDragging = false;
      float.style.cursor = '';
    });

    function onWordClick(el){
      const key = el.dataset.key;
      openFloatFor(key, el.getBoundingClientRect());
    }

    function openFloatFor(key, rect){
      state.currentWord = key;
      wordInput.value = key;
      arabicInput.value = state.words[key] || '';
      // position near selection
      const top = window.scrollY + rect.top - float.offsetHeight - 10;
      const left = window.scrollX + rect.left;
      float.style.top = Math.max(10, top) + 'px';
      float.style.left = Math.max(10, left) + 'px';
      float.style.display = 'block';
      arabicInput.focus();
    }

    saveBtn.addEventListener('click', ()=>{
      const key = normalizeWord(wordInput.value);
      const ar = arabicInput.value.trim();
      if(!key || !ar){
        showToast('Ø§ÙƒØªØ¨ Ø§Ù„ÙƒÙ„Ù…Ø© ÙˆØªØ±Ø¬Ù…ØªÙ‡Ø§ Ø£ÙˆÙ„Ø§Ù‹');
        return;
      }
      state.words[key] = ar;
      saveWords();
      refreshKnownClasses();
      updateTable();
      showToast('âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸');
      float.style.display='none';
    });

    delBtn.addEventListener('click', ()=>{
      const key = normalizeWord(wordInput.value);
      if(!key) return;
      if(state.words[key]){
        delete state.words[key];
        saveWords();
        refreshKnownClasses();
        updateTable();
        showToast('ğŸ—‘ï¸ Ø­ÙØ°ÙØª Ø§Ù„ÙƒÙ„Ù…Ø©');
      }
      float.style.display='none';
    });
    closeFloat.addEventListener('click', ()=> float.style.display='none');

    // Show translation tooltip on double click (or when known word clicked with Alt)
    readingEl.addEventListener('dblclick', (e)=>{
      const target = e.target.closest('span.word');
      if(!target) return;
      const key = target.dataset.key;
      if(state.words[key]) showToast(`${target.textContent} â†’ ${state.words[key]}`);
      else onWordClick(target);
    });

    // ================= Drawer (Review) =================
    const drawer = document.getElementById('drawer');
    const btnReview = document.getElementById('btnReview');
    const search = document.getElementById('search');
    const tableBody = document.querySelector('#table tbody');
    const toggleQuiz = document.getElementById('toggleQuiz');
    const quizSection = document.getElementById('quizSection');

    btnReview.addEventListener('click', ()=> {
      drawer.classList.add('open');
      quizSection.style.display = 'none';
    });
    drawer.querySelectorAll('[data-close]').forEach(el=> el.addEventListener('click', ()=> drawer.classList.remove('open')));

    toggleQuiz.addEventListener('click', () => {
      if (quizSection.style.display === 'none') {
        quizSection.style.display = 'block';
        toggleQuiz.textContent = 'Ø¹Ø±Ø¶ Ø¬Ø¯ÙˆÙ„ Ø§Ù„ÙƒÙ„Ù…Ø§Øª';
        startNewQuiz();
      } else {
        quizSection.style.display = 'none';
        toggleQuiz.textContent = 'Ø¹Ø±Ø¶ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ÙƒÙ„Ù…Ø§Øª';
      }
    });

    function updateTable(){
      const q = search.value.trim().toLowerCase();
      const entries = Object.entries(state.words).sort((a,b)=> a[0].localeCompare(b[0]));
      const filtered = q? entries.filter(([en,ar])=> en.includes(q) || ar.toLowerCase().includes(q)) : entries;
      tableBody.innerHTML = '';
      filtered.forEach(([en,ar])=>{
        const tr = document.createElement('tr');
        const tdEn = document.createElement('td');
        const tdAr = document.createElement('td');
        const tdAct = document.createElement('td'); tdAct.className='actions';

        tdEn.textContent = en;
        tdAr.textContent = ar;

        const edit = document.createElement('button'); edit.className='btn secondary'; edit.textContent='ØªØ¹Ø¯ÙŠÙ„';
        edit.addEventListener('click', ()=>{ openFloatFor(en, {top:100,left:100}); });

        const del = document.createElement('button'); del.className='btn ghost'; del.textContent='Ø­Ø°Ù';
        del.addEventListener('click', ()=>{ if(confirm('Ø­Ø°Ù Ø§Ù„ÙƒÙ„Ù…Ø©ØŸ')){ delete state.words[en]; saveWords(); updateTable(); refreshKnownClasses(); }});

        tdAct.append(edit, del);
        tr.append(tdEn, tdAr, tdAct);
        tableBody.appendChild(tr);
      });
    }
    search.addEventListener('input', updateTable);

    // ================= Quiz System =================
    const quizContainer = document.getElementById('quizContainer');
    const quizQuestion = document.getElementById('quizQuestion');
    const quizOptions = document.getElementById('quizOptions');
    const quizFeedback = document.getElementById('quizFeedback');
    const startQuiz = document.getElementById('startQuiz');
    const nextQuestion = document.getElementById('nextQuestion');
    const quizStats = document.getElementById('quizStats');

    let quizWords = [];
    let currentQuizIndex = 0;
    let correctAnswers = 0;
    let quizInProgress = false;

    startQuiz.addEventListener('click', startNewQuiz);
    nextQuestion.addEventListener('click', showNextQuestion);

    function startNewQuiz() {
      const words = Object.entries(state.words);
      if (words.length < 4) {
        showToast('ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ 4 ÙƒÙ„Ù…Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±');
        return;
      }
      
      // Ø§Ø®ØªÙŠØ§Ø± 10 ÙƒÙ„Ù…Ø§Øª Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© (Ø£Ùˆ Ø£Ù‚Ù„ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø£Ù‚Ù„ Ù…Ù† 10)
      quizWords = shuffleArray([...words]).slice(0, Math.min(10, words.length));
      currentQuizIndex = 0;
      correctAnswers = 0;
      quizInProgress = true;
      
      quizFeedback.textContent = '';
      quizStats.textContent = '';
      nextQuestion.style.display = 'none';
      
      showQuestion();
    }

    function showQuestion() {
      if (currentQuizIndex >= quizWords.length) {
        endQuiz();
        return;
      }
      
      const [word, translation] = quizWords[currentQuizIndex];
      quizQuestion.textContent = `Ù…Ø§ Ù…Ø¹Ù†Ù‰ "${word}"ØŸ`;
      
      // Ø¥Ù†Ø´Ø§Ø¡ 4 Ø®ÙŠØ§Ø±Ø§Øª (Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© + 3 Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©)
      const correctOption = translation;
      const otherOptions = [];
      const allTranslations = Object.values(state.words).filter(t => t !== correctOption);
      
      while (otherOptions.length < 3 && otherOptions.length < allTranslations.length) {
        const randomIndex = Math.floor(Math.random() * allTranslations.length);
        const option = allTranslations[randomIndex];
        if (!otherOptions.includes(option)) {
          otherOptions.push(option);
        }
      }
      
      const options = shuffleArray([correctOption, ...otherOptions]);
      quizOptions.innerHTML = '';
      
      options.forEach((option, index) => {
        const btn = document.createElement('button');
        btn.className = 'btn secondary';
        btn.style.width = '100%';
        btn.style.textAlign = 'right';
        btn.style.direction = 'rtl';
        btn.textContent = option;
        btn.addEventListener('click', () => checkAnswer(option, correctOption, btn));
        quizOptions.appendChild(btn);
      });
      
      quizStats.textContent = `Ø§Ù„Ø³Ø¤Ø§Ù„ ${currentQuizIndex + 1} Ù…Ù† ${quizWords.length} | Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„ØµØ­ÙŠØ­Ø©: ${correctAnswers}`;
    }

    function checkAnswer(selected, correct, button) {
      if (!quizInProgress) return;
      
      if (selected === correct) {
        button.className = 'btn';
        button.style.backgroundColor = 'var(--acc2)';
        quizFeedback.textContent = 'âœ… Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©!';
        correctAnswers++;
      } else {
        button.className = 'btn danger';
        quizFeedback.textContent = `âŒ Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø©! Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©: ${correct}`;
      }
      
      // ØªØ¹Ø·ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø¨Ø¹Ø¯ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©
      Array.from(quizOptions.children).forEach(btn => {
        btn.disabled = true;
        if (btn.textContent === correct) {
          btn.className = 'btn';
          btn.style.backgroundColor = 'var(--acc2)';
        }
      });
      
      nextQuestion.style.display = 'block';
    }

    function showNextQuestion() {
      currentQuizIndex++;
      nextQuestion.style.display = 'none';
      quizFeedback.textContent = '';
      showQuestion();
    }

    function endQuiz() {
      quizInProgress = false;
      quizQuestion.textContent = 'Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù†ØªÙ‡Ù‰!';
      quizOptions.innerHTML = '';
      quizFeedback.textContent = `ğŸ‰ Ù„Ù‚Ø¯ Ø£Ø¬Ø¨Øª Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­ Ø¹Ù„Ù‰ ${correctAnswers} Ù…Ù† ${quizWords.length} Ø£Ø³Ø¦Ù„Ø©!`;
      quizStats.textContent = `Ø§Ù„Ù†Ø³Ø¨Ø©: ${Math.round((correctAnswers / quizWords.length) * 100)}%`;
      nextQuestion.style.display = 'none';
    }

    // Ø¯Ø§Ù„Ø© Ù„Ø®Ù„Ø· Ø§Ù„Ø¹Ù†Ø§ØµØ± ÙÙŠ Ù…ØµÙÙˆÙØ©
    function shuffleArray(array) {
      const newArray = [...array];
      for (let i = newArray.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
      }
      return newArray;
    }

    // ================= Import / Export =================
    const btnExport = document.getElementById('btnExport');
    const fileImport = document.getElementById('fileImport');

    btnExport.addEventListener('click', ()=>{
      const blob = new Blob([JSON.stringify(state.words, null, 2)], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'words.json'; a.click();
      URL.revokeObjectURL(url);
    });

    fileImport.addEventListener('change', (e)=>{
      const file = e.target.files[0]; if(!file) return;
      const reader = new FileReader();
      reader.onload = ()=>{
        try{
          const obj = JSON.parse(reader.result);
          if(typeof obj !== 'object' || Array.isArray(obj)) throw 0;
          state.words = { ...state.words, ...obj };
          saveWords(); updateTable(); refreshKnownClasses(); showToast('ğŸ“¥ ØªÙ… Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯');
        }catch{ showToast('Ù…Ù„Ù ØºÙŠØ± ØµØ§Ù„Ø­'); }
        fileImport.value='';
      };
      reader.readAsText(file);
    });

    // ================= Reset =================
    document.getElementById('btnResetAll').addEventListener('click', ()=>{
      if(confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©ØŸ')){
        state.words = {}; saveWords(); updateTable(); refreshKnownClasses(); showToast('ØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙƒÙ„Ù…Ø§Øª');
      }
    });

    // ================= Toast =================
    const toast = document.getElementById('toast');
    let toastTimer;
    function showToast(msg){
      toast.textContent = msg; toast.style.display='block';
      clearTimeout(toastTimer);
      toastTimer = setTimeout(()=> toast.style.display='none', 2200);
    }

    // ============= Restore session (if any) =============
    updateTable();

    // Optional: sample text for quick try
    if(!rawTextEl.value){
      rawTextEl.value = "Learning English through reading is powerful. Click any word to add your Arabic translation and review it later.";
    }
  </script>
  <!-- Footer -->
<footer style="text-align: center; padding: 20px; background: #0d1117; color: #fff;">
  <div style="
    display: flex; 
    flex-direction: row; 
    justify-content: center; 
    align-items: center; 
    gap: 20px; 
    flex-wrap: wrap;
  ">
    <!-- Logo -->
    <img src="logo.png" alt="Logo" style="
      width: 80px; 
      height: auto; 
      border-radius: 10px;
    ">

    <!-- Icon -->
    <img src="icon.png" alt="Site Icon" style="
      width: 60px; 
      height: auto; 
      border-radius: 10px;
    ">
  </div>
  <p style="margin-top: 10px; font-size: 14px; color: #ccc;">
    &copy; 2025 Reading Translator
  </p>
</footer>

<!-- Responsive for Mobile -->
<style>
  @media (max-width: 600px) {
    footer div {
      flex-direction: column !important;
    }
  }
</style>

</body>
</html>
