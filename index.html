<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8" />
  <!-- Website Icon (Favicon) -->
<link rel="icon" href="icon.png" type="image/png">

<!-- Open Graph (Facebook, WhatsApp, LinkedIn preview) -->
<meta property="og:image" content="https://samer7667.github.io/reading-translator/icon.png">
<meta property="og:title" content="Reading Translator">
<meta property="og:description" content="ترجم الكلمات الإنجليزية واحفظها لمراجعتها لاحقًا">
<meta property="og:type" content="website">
<meta property="og:url" content="https://samer7667.github.io/reading-translator/">

<!-- Twitter Card preview -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Reading Translator">
<meta name="twitter:description" content="ترجم الكلمات الإنجليزية واحفظها لمراجعتها لاحقًا">
<meta name="twitter:image" content="https://samer7667.github.io/reading-translator/icon.png">

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Reading Word Translator — EN ⇢ AR</title>
  <style>
    :root{
      --bg:#0b1220; --panel:#121a2b; --muted:#8aa0bf; --text:#e9f0ff; --acc:#5ea0ff; --acc2:#7ef0d6; --warn:#ff9f43; --danger:#ff5d5d;
      --ring: 0 0 0 3px rgba(94,160,255,.3);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,"Noto Sans",sans-serif;background:linear-gradient(180deg,#0b1220,#0e1626 60%);color:var(--text)}
    a{color:var(--acc)}
    .container{max-width:1100px;margin:0 auto;padding:16px}
    .app{display:grid;grid-template-columns:1fr;gap:16px}
    @media(min-width:900px){.app{grid-template-columns:340px 1fr}}
    .card{background:var(--panel);border:1px solid rgba(255,255,255,.07);border-radius:18px;box-shadow:0 10px 30px rgba(0,0,0,.3)}
    .card h2{margin:0 0 8px 0;font-size:20px}
    .card .body{padding:16px}
    .muted{color:var(--muted)}
    .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .btn{appearance:none;border:none;border-radius:14px;padding:10px 14px;font-weight:600;color:#071225;background:var(--acc);cursor:pointer;transition:.2s;box-shadow:0 6px 20px rgba(94,160,255,.25)}
    .btn:hover{transform:translateY(-1px)}
    .btn.secondary{background:#1f2b44;color:var(--text);box-shadow:none;border:1px solid rgba(255,255,255,.08)}
    .btn.ghost{background:transparent;color:var(--text);border:1px dashed rgba(255,255,255,.2)}
    .btn.warn{background:var(--warn)}
    .btn.danger{background:var(--danger)}
    .field{display:flex;flex-direction:column;gap:6px}
    .input, textarea{width:100%;background:#0a1221;border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:10px 12px;color:var(--text);outline:none}
    .input:focus, textarea:focus{box-shadow:var(--ring);border-color:rgba(94,160,255,.5)}
    textarea{min-height:120px;resize:vertical}
    .reading{line-height:1.9;background:#0a1221;border:1px solid rgba(255,255,255,.08);border-radius:16px;padding:16px;min-height:220px}
    .reading span.word{padding:2px 0;border-radius:6px;cursor:pointer}
    .reading span.word.known{background:rgba(126,240,214,.12);box-shadow:inset 0 0 0 1px rgba(126,240,214,.35)}
    .reading span.word:hover{background:rgba(94,160,255,.12)}

    .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:24px;background:#0a1221;border:1px solid rgba(255,255,255,.1);padding:10px 12px;border-radius:12px;display:none;z-index:50}

    .floating{position:absolute;z-index:40;min-width:260px;background:#0a1221;border:1px solid rgba(255,255,255,.12);border-radius:14px;box-shadow:0 10px 40px rgba(0,0,0,.5);padding:12px;display:none}
    .floating h4{margin:0 0 8px 0;font-size:14px;color:var(--muted)}

    /* Drawer */
    .drawer{position:fixed;inset:0;pointer-events:none}
    .drawer.open{pointer-events:auto}
    .drawer .backdrop{position:absolute;inset:0;background:rgba(0,0,0,.55);opacity:0;transition:.2s}
    .drawer.open .backdrop{opacity:1}
    .drawer .panel{position:absolute;top:0;right:-420px;width:420px;max-width:100%;height:100%;background:var(--panel);border-left:1px solid rgba(255,255,255,.08);transition:.25s;padding:16px;overflow:auto}
    .drawer.open .panel{right:0}
    table{width:100%;border-collapse:collapse}
    th,td{border-bottom:1px solid rgba(255,255,255,.08);padding:8px 6px;text-align:left}
    td.actions{white-space:nowrap}
    .tag{display:inline-block;padding:2px 8px;border-radius:999px;background:#11203a;color:var(--muted);font-size:12px}
  </style>
</head>
<body>
  <div class="container">
    <header style="display:flex;align-items:center;justify-content:space-between;gap:12px;margin:10px 0 16px 0">
      <div>
        <h1 style="margin:0;font-size:26px">📖 Reading Word Translator <span class="tag">EN ⇢ AR</span></h1>
        <div class="muted" style="font-size:14px">انقر/حدّد كلمة إنجليزية داخل النص، ثم اكتب ترجمتها بالعربية وسيتم حفظها للمراجعة (محليًا في جهازك).</div>
      </div>
      <div class="row">
        <button id="btnReview" class="btn">مراجعة الكلمات</button>
        <button id="btnExport" class="btn secondary" title="تصدير الكلمات كـ JSON">تصدير</button>
        <label class="btn ghost" title="استيراد ملف JSON للكلمات" for="fileImport">استيراد</label>
        <input id="fileImport" type="file" accept="application/json" style="display:none" />
      </div>
    </header>

    <div class="app">
      <section class="card">
        <div class="body">
          <h2>1) ضع النص الإنجليزي</h2>
          <div class="field" style="margin-bottom:10px">
            <label class="muted">لصق/كتابة النص هنا ثم اضغط «تجهيز النص»</label>
            <textarea id="rawText" placeholder="Paste your English text here…"></textarea>
          </div>
          <div class="row" style="justify-content:space-between">
            <div class="row">
              <button id="btnBuild" class="btn">تجهيز النص</button>
              <button id="btnClearText" class="btn secondary">مسح النص</button>
            </div>
            <button id="btnResetAll" class="btn danger" title="حذف كل الكلمات المحفوظة">حذف الكلمات المحفوظة</button>
          </div>
        </div>
      </section>

      <section class="card" style="position:relative">
        <div class="body">
          <h2>2) اقرأ النص وانقر على الكلمات</h2>
          <div id="reading" class="reading" tabindex="0" aria-label="Reading Area"></div>
          <div class="muted" style="margin-top:8px;font-size:13px">نصيحة: انقر نقرًا مزدوجًا على كلمة لاختيارها سريعًا. الكلمات المعروفة تُظلل بخضرة خفيفة.</div>
        </div>

        <!-- Floating translator -->
        <div id="float" class="floating" role="dialog" aria-modal="true">
          <h4>ترجمة الكلمة</h4>
          <div class="field"><input id="wordInput" class="input" placeholder="English word" /></div>
          <div class="field" style="direction:rtl"><input id="arabicInput" class="input" placeholder="اكتب الترجمة بالعربية" /></div>
          <div class="row" style="justify-content:flex-end;margin-top:8px">
            <button id="saveWord" class="btn">حفظ</button>
            <button id="deleteWord" class="btn secondary">حذف</button>
            <button id="closeFloat" class="btn ghost">إغلاق</button>
          </div>
        </div>
      </section>
    </div>
  </div>

  <!-- Drawer for Review -->
  <div id="drawer" class="drawer" aria-hidden="true">
    <div class="backdrop" data-close></div>
    <aside class="panel">
      <div style="display:flex;justify-content:space-between;align-items:center;gap:8px;position:sticky;top:0;background:var(--panel);padding-bottom:8px;z-index:1">
        <h2 style="margin:8px 0">📚 مراجعة الكلمات</h2>
        <button class="btn ghost" data-close>إغلاق</button>
      </div>
      <div class="row" style="margin:6px 0 10px 0">
        <input id="search" class="input" placeholder="بحث… (English أو العربية)" />
      </div>
      <table id="table">
        <thead><tr><th>English</th><th style="direction:rtl">العربية</th><th>Actions</th></tr></thead>
        <tbody></tbody>
      </table>
      <div class="muted" style="font-size:12px;margin-top:10px">يتم الحفظ محليًا في المتصفح (localStorage). يمكنك التصدير/الاستيراد كملف JSON.</div>
    </aside>
  </div>

  <div id="toast" class="toast"></div>

  <script>
    // ================= Core State =================
    const LS_KEY = 'readingTranslator.words.v1';
    const state = {
      words: loadWords(),
      currentWord: '',
    };

    function normalizeWord(w){
      if(!w) return '';
      return w
        .toLowerCase()
        .replace(/[\u2018\u2019]/g,"'")
        .replace(/^[^a-zA-Z']+|[^a-zA-Z']+$/g,'');
    }

    function loadWords(){
      try{ return JSON.parse(localStorage.getItem(LS_KEY) || '{}'); }
      catch{ return {}; }
    }
    function saveWords(){ localStorage.setItem(LS_KEY, JSON.stringify(state.words)); }

    // ================= Building Reading =================
    const readingEl = document.getElementById('reading');
    const rawTextEl = document.getElementById('rawText');
    const btnBuild = document.getElementById('btnBuild');
    const btnClearText = document.getElementById('btnClearText');

    btnBuild.addEventListener('click', () => buildReading(rawTextEl.value));
    btnClearText.addEventListener('click', () => { rawTextEl.value=''; readingEl.innerHTML=''; });

    function buildReading(text){
      const tokens = text.split(/(\s+)/); // keep spaces
      readingEl.innerHTML = '';
      tokens.forEach(tok => {
        if(/\s+/.test(tok)){ readingEl.appendChild(document.createTextNode(tok)); return; }
        const clean = normalizeWord(tok);
        if(!clean){ readingEl.appendChild(document.createTextNode(tok)); return; }
        const span = document.createElement('span');
        span.className = 'word' + (state.words[clean] ? ' known':'' );
        span.textContent = tok; // keep original casing/punct
        span.dataset.key = clean;
        span.title = state.words[clean] ? `→ ${state.words[clean]}` : 'Click to translate';
        span.addEventListener('click', (e)=> onWordClick(e.currentTarget));
        readingEl.appendChild(span);
      });
    }

    function refreshKnownClasses(){
      readingEl.querySelectorAll('span.word').forEach(el => {
        const key = el.dataset.key;
        el.classList.toggle('known', !!state.words[key]);
        if(state.words[key]) el.title = `→ ${state.words[key]}`; else el.removeAttribute('title');
      });
    }

    // ================= Floating Panel =================
    const float = document.getElementById('float');
    const wordInput = document.getElementById('wordInput');
    const arabicInput = document.getElementById('arabicInput');
    const saveBtn = document.getElementById('saveWord');
    const delBtn = document.getElementById('deleteWord');
    const closeFloat = document.getElementById('closeFloat');

    function onWordClick(el){
      const key = el.dataset.key;
      openFloatFor(key, el.getBoundingClientRect());
    }

    function openFloatFor(key, rect){
      state.currentWord = key;
      wordInput.value = key;
      arabicInput.value = state.words[key] || '';
      // position near selection
      const top = window.scrollY + rect.top - float.offsetHeight - 10;
      const left = window.scrollX + rect.left;
      float.style.top = Math.max(10, top) + 'px';
      float.style.left = Math.max(10, left) + 'px';
      float.style.display = 'block';
      arabicInput.focus();
    }

    saveBtn.addEventListener('click', ()=>{
      const key = normalizeWord(wordInput.value);
      const ar = arabicInput.value.trim();
      if(!key || !ar){
        showToast('اكتب الكلمة وترجمتها أولاً');
        return;
      }
      state.words[key] = ar;
      saveWords();
      refreshKnownClasses();
      updateTable();
      showToast('✅ تم الحفظ');
      float.style.display='none';
    });

    delBtn.addEventListener('click', ()=>{
      const key = normalizeWord(wordInput.value);
      if(!key) return;
      if(state.words[key]){
        delete state.words[key];
        saveWords();
        refreshKnownClasses();
        updateTable();
        showToast('🗑️ حُذفت الكلمة');
      }
      float.style.display='none';
    });
    closeFloat.addEventListener('click', ()=> float.style.display='none');

    // Show translation tooltip on double click (or when known word clicked with Alt)
    readingEl.addEventListener('dblclick', (e)=>{
      const target = e.target.closest('span.word');
      if(!target) return;
      const key = target.dataset.key;
      if(state.words[key]) showToast(`${target.textContent} → ${state.words[key]}`);
      else onWordClick(target);
    });

    // ================= Drawer (Review) =================
    const drawer = document.getElementById('drawer');
    const btnReview = document.getElementById('btnReview');
    const search = document.getElementById('search');
    const tableBody = document.querySelector('#table tbody');

    btnReview.addEventListener('click', ()=> drawer.classList.add('open'));
    drawer.querySelectorAll('[data-close]').forEach(el=> el.addEventListener('click', ()=> drawer.classList.remove('open')));

    function updateTable(){
      const q = search.value.trim().toLowerCase();
      const entries = Object.entries(state.words).sort((a,b)=> a[0].localeCompare(b[0]));
      const filtered = q? entries.filter(([en,ar])=> en.includes(q) || ar.toLowerCase().includes(q)) : entries;
      tableBody.innerHTML = '';
      filtered.forEach(([en,ar])=>{
        const tr = document.createElement('tr');
        const tdEn = document.createElement('td');
        const tdAr = document.createElement('td');
        const tdAct = document.createElement('td'); tdAct.className='actions';

        tdEn.textContent = en;
        tdAr.textContent = ar;

        const edit = document.createElement('button'); edit.className='btn secondary'; edit.textContent='تعديل';
        edit.addEventListener('click', ()=>{ openFloatFor(en, {top:100,left:100}); });

        const del = document.createElement('button'); del.className='btn ghost'; del.textContent='حذف';
        del.addEventListener('click', ()=>{ if(confirm('حذف الكلمة؟')){ delete state.words[en]; saveWords(); updateTable(); refreshKnownClasses(); }});

        tdAct.append(edit, del);
        tr.append(tdEn, tdAr, tdAct);
        tableBody.appendChild(tr);
      });
    }
    search.addEventListener('input', updateTable);

    // ================= Import / Export =================
    const btnExport = document.getElementById('btnExport');
    const fileImport = document.getElementById('fileImport');

    btnExport.addEventListener('click', ()=>{
      const blob = new Blob([JSON.stringify(state.words, null, 2)], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'words.json'; a.click();
      URL.revokeObjectURL(url);
    });

    fileImport.addEventListener('change', (e)=>{
      const file = e.target.files[0]; if(!file) return;
      const reader = new FileReader();
      reader.onload = ()=>{
        try{
          const obj = JSON.parse(reader.result);
          if(typeof obj !== 'object' || Array.isArray(obj)) throw 0;
          state.words = { ...state.words, ...obj };
          saveWords(); updateTable(); refreshKnownClasses(); showToast('📥 تم الاستيراد');
        }catch{ showToast('ملف غير صالح'); }
        fileImport.value='';
      };
      reader.readAsText(file);
    });

    // ================= Reset =================
    document.getElementById('btnResetAll').addEventListener('click', ()=>{
      if(confirm('هل تريد حذف جميع الكلمات المحفوظة؟')){
        state.words = {}; saveWords(); updateTable(); refreshKnownClasses(); showToast('تم حذف جميع الكلمات');
      }
    });

    // ================= Toast =================
    const toast = document.getElementById('toast');
    let toastTimer;
    function showToast(msg){
      toast.textContent = msg; toast.style.display='block';
      clearTimeout(toastTimer);
      toastTimer = setTimeout(()=> toast.style.display='none', 2200);
    }

    // ============= Restore session (if any) =============
    updateTable();

    // Optional: sample text for quick try
    if(!rawTextEl.value){
      rawTextEl.value = "Learning English through reading is powerful. Click any word to add your Arabic translation and review it later.";
    }
  </script>
  <!-- Footer -->
<footer style="text-align: center; padding: 20px; background: #0d1117; color: #fff;">
  <div style="
    display: flex; 
    flex-direction: row; 
    justify-content: center; 
    align-items: center; 
    gap: 20px; 
    flex-wrap: wrap;
  ">
    <!-- Logo -->
    <img src="logo.png" alt="Logo" style="
      width: 80px; 
      height: auto; 
      border-radius: 10px;
    ">

    <!-- Icon -->
    <img src="icon.png" alt="Site Icon" style="
      width: 60px; 
      height: auto; 
      border-radius: 10px;
    ">
  </div>
  <p style="margin-top: 10px; font-size: 14px; color: #ccc;">
    &copy; 2025 Reading Translator
  </p>
</footer>

<!-- Responsive for Mobile -->
<style>
  @media (max-width: 600px) {
    footer div {
      flex-direction: column !important;
    }
  }
</style>

</body>
</html>
